---
title: "Clase_7"
format: html
editor: visual
---

# **Clase 7: Pruebas de hipótesis para la media entre grupos en Python**

## Pruebas de hipótesis

Las pruebas de hipótesis son una herramienta muy útil en la estadística inferencial, la cual usamos para tomar una decisión sobre una población basandonos en una muestra de la misma. Son usadas para evaluar afirmaciones o suposiciones sobre una característica desconocida de una población.

Aquí introducimos el concepto de hipótesis nula e hipótesis alternativa , nivel de significación y errores Tipo I y Tipo II:

-   Hipótesis nula ( $H_0$ ): Es lo que queremos poner a prueba, lo que se cree en un inicio es verdad.

-   Hipótesis alternativa ( $H_1$ ): Es lo que se acepta si los datos nos dan evidencia para rechazar la hipótesis nula, la negación de $H_0$.

-   Nivel de significación ( $\alpha$): Representa la probabilidad de cometer un error de tipo I al rechazar incorrectamente la hipótesis nula.

-   Error Tipo I: Rechazar incorrectamente la hipóstesis nula cuando es verdadera.

-   Error Tipo II: No rechazar la hipótesis nula cuando es falsa.

Definidas las hipótesis a contrastar se realiza una prueba donde se obtendrá un valor llamado *valor p*. Veremos cuando este es significativo (por lo general mayor que 0.05) y como se le usa para rechazar $H_0$. Otro punto a tomar en cuenta es nuestro tamaño de muestra, por lo general un número mayor a 30 es considerado grande y es posible usar algunos resultados estadísticos para aproximar nuestros resultados, si esto no ocurre tendremos que usar otras técnicas.

## Casos cuando existe varianza en los grupos

Aunque los paquetes hagan la mayoría de trabajo no esta de más saber los distintos casos que existen en estas pruebas de hipótesis

### Caso cuando la varianza poblacional es desconocida

Es es el caso más común, en este desconocemos la varianza poblacional y por lo general se usa una distribucion $t$ de Student en lugar de una normal.

En este caso usamos un estadístico de prueba $t=\frac{\bar{x}-u_0}{s/\sqrt{n}}$ donde $s$ es la desciación estándar y n el tamaño de la muestra y el cual sigue una distribución de Student con $n-1$ grados de libertad.

Cabe recalcar que lo antes mencionado es solamente cuando tenemos una muestra, veamo ahora casos cuando queremos comparar dos muestras.

### Caso cuando las varianzas son desconocidas pero iguales

Este caso es de los casos más comunes, aquí tenemos dos medias cuyas varianzas son desconocidas. Primero debemos hacer una prueba F $(F=\frac{s_1^2}{s_2^2})$ para probar si las varianzas son iguales y luego podemos usar el estadístico siguiente $$
t=\frac{(\bar{x}_1-\bar{x}_2)-(u_1-u_2)}{s_p\sqrt{1/n_1+1/n_2}}
$$ donde $$
s^2_p=\frac{s_1^2(n_1-1)+s_2^2(n_2-1)}{n_1+n_2-2}
$$ con grados de libertad dados por $v=n_1+n_2-2$

### Caso cuando las varianzas son desconocidas pero distintas

Si luego de realizar la prueba F sobre las varianzas tenemos que no se pueden considerar iguales tenemos que uasr el siguiente estadístico $$
t=\frac{(\bar{x}_1-\bar{x}_2)-(u_1-u_2)}{\sqrt{s_1^2/n_1+s_2^2/n_2}}
$$ donde los grados de libertad vienen dados por $$
v=\frac{(s_1^2/n_1+s_2^2/n_2)^2}{\frac{(s_1^2)^2}{(n_1-1)n_1^2}+\frac{(s_2^2)^2}{(n_2-1)n_2^2}}
$$ y este valor rara vez será un número entero, por lo que será redondeado al menor entero más cercano.

## Biblioteca Scipy

Ahora que conocemos algunos casos que se nos podrían presentar vamos a ver como usar Python para solventarlos.

Primero debemos instalar la librería y de la misma llamar a la funcion stats, puedes hacerlo de la siguiente manera:

```{python}
pip install scipy

from scipy import stats
```

Listo, ahora veamos algunos casos

-   Caso de una sola población:

    Pongamos el siguiente caso, tomando nustro archivo de emisiones de CO2 y con la media poblacional. Supongamos que Australia cree que la media de emisiones en estos 30 años es de 340000 kt de C02, con esto hacemos nuestra prueba de hipótesis.

```{python}
#Cargamos las librerias 
import pandas as pd
import numpy as np 
from scipy import stats


# Leemos nuestro archivo de datos de CO2
ruta_archivo_excel = 'C:/Users/Brad/Documents/curso_python_poli_dec/data/co2.xlsx'

# Creamos un objeto llamado datos para almacenarlo
datos = pd.read_excel(ruta_archivo_excel)

#Seleccionar los dos países
fila_seleccionada = datos.iloc[9,4:]


#Tranformamos
australia = np.array(fila_seleccionada) 

#Calculamos medidas de dispersion para despues
media_muestra = np.mean(australia)
desviacion = np.std(australia)

#Definimos u_0
u_0 = 340000

#Realizamos el test

resultado = stats.ttest_1samp(australia,u_0)

#comprobamos nuestro valor p
resultado.pvalue<0.05


```

Como podemos observar no tenemos evidencia suficiente para rechazar la hipotesis dicha al principio, esto puede ser gracias a la desviacion de los datos, las brechas entre ellos debido al incremento en las industrias en el país, pero sirve para ilustrar cómo realizar pruebas de hipótesis.

Podemos incluso corroborar el estadístico que obtenemos con el siguiente código

```{python}
## Hagamos de forma manual para corroborar 
t_prueba=(media_muestra-u_0)/(desviacion/np.sqrt(len(australia)))

#Vemos el estadistico calculado manualmente
print(t_prueba)

#Obtenemos el estadítico de la función anterior
print(resultado.statistic)
```

> Si bien los resultados difieren por decimales esto es normal ya que la librería usa un número mayor de decimales

-   Caso de dos poblaciones:

    Tomemos nuestros datos sobre las emiciones de CO2 por cada país, tomemos dos de ellos, Emiratos Árabes y Argentina, y propongamos las siguientes hipotesis

    -   $H_0$ : Ambos países tienen, en promedio, las mismas emisiones de CO2 ( $u_1=u_2$ ).

    -   $H_1$ : Las medias son distintas.

    Veamos como dar una respuesta usando python

```{python}

#Seleccionar los dos países
fila_seleccionada1 = datos.iloc[5,4:]
fila_seleccionada2 = datos.iloc[6,4:]

#Tranformamos
emiratos = np.array(fila_seleccionada1) 
argentina = np.array(fila_seleccionada2)

#buscamos el valor p mencionado
resultado2 = stats.ttest_ind(emiratos, argentina,equal_var=False)
print(resultado2.pvalue)
#solo en la nueva versión --> print(resultado2.df) grados de libertad
```

Con ello podemos ver que el valor p es mayor a 0.05, por lo que no rechazamos la hipotesis nula y podriamos considerar que ambos países tienen, en promedio, una emisión igual. Notemos que un parámetro de la función es `equal_var`este por defecto lleva el valor "True", pero si conocemos que son dsitintas podemos cambiarlo.

Incluso podemos realizar esto de manera manual para comprobar, el código es el siguiente

```{python}
#medidas que nos ayudaran a simplificar las operaciones
desv1 = np.std(emiratos)
media1 = np.mean(emiratos)
desv2 = np.std(argentina)
media2 = np.mean(argentina)
var1 = desv1**2
var2 = desv2**2

#Primero verificamos si las varianzas son iguales
#Utilizamos el estadítico F de prueba
F_prueba = desv2**2/desv1**2
F_prueba

#Limites de rechazo prueba F
F_est1 = stats.f.ppf(0.975,30,30)
F_est1
F_est2 = stats.f.ppf(0.025,30,30)
F_est2

# Rechazamos la hipotesis de que las varianzas son iguales, por tanto realizamos el análisis tomando en cuenta el tercer caso explicado anteriormente

t_calculado = (media1-media2)/np.sqrt((desv1**2/31)+(desv2**2/31))
t_calculado

#grados de libertad
v_arriba = ((var1/31)+(var2/31))**2
v_abajo = ((var1/31)**2/30)+((var2/31)**2/30)
v = v_arriba/v_abajo
v 

#limites de rechazo para t
t_est1= stats.t.ppf(0.025,47) 
t_est1
t_est2 = stats.t.ppf(0.975,47)
t_est2

#Vemos que decidimos
if t_est1<=t_calculado<=t_est2:
    print("No se rechaza H_0")
else:
    print("Se rechaza H_0")

```

Se pueden cambiar más cosas para realizar pruebas de hipótesis (además de ver las funciones de distribucion y densidad de algunas distribuciones de probabilidad), se recomienda leer la documentación oficial de Scipy, la cual es la siguiente: https://docs.scipy.org/doc/scipy/reference/stats.html
